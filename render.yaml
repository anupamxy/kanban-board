services:
  - type: web
    name: kanban-app
    env: node
    plan: free
    buildCommand: >-
      npm install --prefix frontend &&
      npm run build --prefix frontend &&
      npm install --prefix backend &&
      npm run build --prefix backend &&
      mkdir -p backend/dist/public &&
      cp -r frontend/dist/. backend/dist/public
    startCommand: node backend/dist/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: kanban-db
          property: connectionString

databases:
  - name: kanban-db
    plan: free
    databaseName: kanban_db
    user: kanban
